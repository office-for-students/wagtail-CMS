{% extends "base.html" %}
{% include 'courses/partials/sticky_header.html' %}
{% load staticfiles sass_tags wagtailcore_tags discover_uni_tags %}


{% block extra_css %}
    <link href="{% sass_src 'scss/course_comparison.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/home.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/course_detail.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/accordions.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
    <script type="text/javascript" src="{% static 'js/ratings.js' %}?{% code_version %}"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script type="text/javascript" src="{% static 'js/doughnut_chart.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/bar_chart.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/label_explanation_popups.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/overview_blocks.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/sub_accordion.js' %}?{% code_version %}"></script>

    <script>
        var saved_courses = JSON.parse(localStorage.getItem("comparisonCourses"));
        var compare_list = JSON.parse(localStorage.getItem('compareCourses'));
    </script>

{% endblock %}

{% block content %}

    <div class="comparison d-sm-block mb-5">
        <div class="comparison__body pt-1">

            <h2 class="comparison__heading">
                {{ page.compare_heading }}
            </h2>

            <div class="comparison__top-container">
                <div class="comparison__top-container-need-help-box">
                    <h4>{% get_translation key='need_help_choosing' language=page.get_language %}</h4>
                    <p>{% get_translation key='search_guidelines' language=page.get_language %}</p>
                    <p style="margin-bottom: 0px;">
                        {% autoescape off %}{% get_translation key='information_advice' language=page.get_language %}{% endautoescape %}
                    </p>
                </div>
                <div class="comparison__top-container-add-btn">

                    <a id="addCourses" href="/{% get_translation key='bookmarks-manage' language=page.get_language %}/"
                       class="comparison__top-container-add-btn-add-courses-button">
                        <span style="font-size:20px;">+</span>
                        <span>{% get_translation key='add_saved_course' language=page.get_language %}</span>
                    </a>

                    <p class="comparison__top-container-add-btn-compare-text">
                        {% get_translation key='compare_7_courses' language=page.get_language %}
                    </p>
                </div>

            </div>
            <!-- Course Search box -->
            <div id="courseSearchContainer" class="course-search-container hidden">
                <div class="no_courses_saved">
                    {% get_translation key='no_courses_saved' language=page.get_language %}
                </div>
                <div class="course_comparison-search bg-white pb-5">
                    <div class="row course_compare_search">
                        {% include 'coursefinder/partials/coursesearch/searchbox.html' %}
                        <div class="col-12 d-block d-lg-none mx-auto text-center">
                            <hr class="dash"/>
                        </div>
                        {% include 'coursefinder/partials/coursesearch/coursewizard.html' %}
                    </div>
                </div>
            </div>
            <!-- Course Search box end -->
            <div class="course-detail__course-container">
                {% if courses %}
                <div class="course-detail__course-selected">
                    {{ courses|length }} {% get_translation key='courses_selected' language=page.get_language %}
                </div>
                <form id="compareForm" method="GET"
                      action="/{% get_translation key='course_comparison_link' language=page.get_language %}">
                    <div id="hiddenCourseCompare"></div>
                </form>

                <div class="course-detail__course-container-pills">
                    <div class="course-detail__course-container-pills-slider"
                         onclick="scrollDisplay(-1);" id="leftArrow">
                        <i class="course-detail__course-container-pills-slider-arrow fas fa-chevron-left"></i>
                    </div>
                    {% for course in courses %}
                        {% include 'courses/partials/course_comparison_overview.html' %}
                    {% endfor %}
                    <div class="course-detail__course-container-pills-slider single-arrow"
                         onclick="scrollDisplay(1);" id="rightArrow">
                        <i class="course-detail__course-container-pills-slider-arrow fas fa-chevron-right"></i>
                    </div>
                </div>
                {% else %}
                <div class="course-detail__course-none-selected">
                    <div class="course-detail__course-none-selected-header">
                        {% get_translation key='no_courses_selected' language=page.get_language %}
                    </div>
                    <p>{% get_translation key='add_two_courses' language=page.get_language %}</p>
                </div>
                {% endif %}
            </div>
            {% if courses %}
                <div id="course-info-container">
                    {% with dataset=courses_data.0.course_details %}
                        <div class="course_comparison-table__row-header">
                            {{ dataset.title }}
                        </div>
                        {% for item, value in dataset.dataset.items %}
                            {% if forloop.counter == 3 %}
                                <!-- Hidden content start -->
                                <div class="accordion" id="initial-accordian">
                                <div class="accordion-body">

                            {% endif %}
                        <div class="course_comparison-table__row-grey_background">
                            {% include 'courses/partials/comparison_courses_row.html' with title=value.title values=value.values %}
                        </div>
                        {% if forloop.last %}
                            </div>
                            <!-- Hidden content end -->
                            <!-- Show more start-->
                            {% with action=dataset.call_to_action.0.show_more %}
                                <div tabindex="0" role="button" aria-label="{{ action.affirmative }}"
                                     class="accordion-header">
                                <div class="accordion-title">
                                <div class="accordion-header course_comparison-table__column-first">
                                <i class="fas fa-chevron-down expand chevron" alt="expand"
                                   aria-label="{{ action.affirmative }}"></i>
                                <i class="fas fa-chevron-up collapse chevron" alt="collapse"
                                   aria-label="{{ action.negative }}"></i>
                                <span class="expand">{{ action.affirmative }}</span>
                                <span class="collapse">{{ action.negative }}</span>
                            {% endwith %}
                        </div>
                        </div>

                        </div>
                            <!-- show more end -->
                        {% endif %}
                        {% endfor %}
                    {% endwith %}
                    </div>
                    <div class="course-detail__body">
                        {% for accordion in courses_data.0.accordions %}
                            <div class="accordion" id="ac-{{ forloop.counter }}">
                                <div tabindex="{{ forloop.counter }}" role="button" aria-label="Show content"
                                     class="green narrow accordion-header sticky-accordion-header">
                                    <div class="">
                                        <div id="{{ accordion.value.heading }}" style="max-width: 440px;"
                                             class="accordion-title"
                                             aria-label="Show {{ accordion.value.heading }} content"
                                             aria-expanded="false">{{ accordion.title }}
                                        </div>
                                    </div>
                                    <div class="expand" style="display: block;">
                                        <img class="nav-card__icon" src="/static/images/plus_icon_white.svg"
                                             alt="expand">
                                    </div>
                                    <div class="collapse">
                                        <img class="nav-card__icon" src="/static/images/minus_icon.svg" alt="collapse">
                                    </div>
                                </div>
                                <div class="accordion-body">
                                    {% include 'courses/partials/accordion_body.html' %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <!-- {% include 'courses/partials/compare-popup-bar.html' %} -->
                </div>
            {% endif %}
        </div>
    </div>
    {% if courses %}
        <script type="text/javascript" src="{% static 'js/arrows.js' %}?{% code_version %}"></script>
    {% endif %}
    <script>
            var course_search_container = document.getElementById("courseSearchContainer");
            if(!(saved_courses) || saved_courses === 0){
                course_search_container.classList.remove("hidden")
            }
    </script>
    <script>
        var element_height = $(".course-detail__course-container-pills").height();
        let accordion_header = $(".sticky-accordion-header");
        accordion_header.css('top', element_height + 20 + "px");
        accordion_header.css('position', "sticky");
        accordion_header.css("z-index", "98");
    </script>

{% endblock %}

