{% extends "base.html" %}
{% include 'courses/partials/sticky_header.html' %}
{% load staticfiles sass_tags wagtailcore_tags discover_uni_tags %}


{% block extra_css %}
    <link href="{% sass_src 'scss/course_comparison.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/course_detail.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
    <script type="text/javascript" src="{% static 'js/course_detail_accordions.js' %}?{% code_version %}"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script type="text/javascript" src="{% static 'js/doughnut_chart.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/bar_chart.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/label_explanation_popups.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/overview_blocks.js' %}?{% code_version %}"></script>

    <script>

        var compare_list = JSON.parse(localStorage.getItem("compareCourses"));

        function toggle_icon(icon_id) {
            var icon_name = "#" + icon_id;
            $(icon_name).toggleClass("fa-plus");
            $(icon_name).toggleClass("fa-minus");
        }

        function removeCourseCompare(index) {
            compare_list.splice(index, 1);
            localStorage.setItem('compareCourses', JSON.stringify(compare_list));

            var checkbox = document.getElementById("course" + index);
            const form = document.getElementById("compareForm");
            checkbox.checked = false;

            form.submit();
        }

        window.addEventListener("load", function () {
            var saved_institutions = JSON.parse(localStorage.getItem("comparisonCourses"));
            var add_courses_link = document.getElementById("addCoursesLink")
            var add_courses_button = document.getElementById("addCourses")
            var id_list = [];
            var hidden_check = document.getElementById("hiddenCourseCompare");

            for (var i = 0; i < compare_list.length; i++) {
                id_list.push(compare_list[i].id);
            }

            var index = 0
            for (var i = 0; i < saved_institutions.length; i++) {
                let courseId = saved_institutions[i].courseId
                let query = saved_institutions[i].uniId + ',' + courseId + ',' + saved_institutions[i].mode.en

                if (id_list.includes(courseId)) {
                    document.getElementById("hiddenCourseCompare").innerHTML += `<input id="${'course' + index}" type="checkbox" value="${query}" name="courses" hidden checked>`
                    index++
                }
            }

            if (compare_list.length === 7) {
                add_courses_link.href = "";
                add_courses_button.disabled = true;
                add_courses_button.style.backgroundColor = "grey";
            }
        });

        function addStarRating(id, value, index) {
            var star = document.getElementById(id);

            if (+value > compare_list[index].rating) {
                for (var i = 1; i <= value; i++) {
                    var star_fill = document.getElementById("course-" + index + "-star" + i);
                    star_fill.innerHTML = "★";
                    star_fill.classList.add("orange");
                }
                compare_list[index].rating = +value
            } else if (+value < compare_list[index].rating) {
                for (var i = 3; i > +value; i--) {
                    var star_fill = document.getElementById("course-" + index + "-star" + i);
                    star_fill.innerHTML = "☆";
                    star_fill.classList.remove("orange");
                }
                compare_list[index].rating = +value
            } else if (compare_list[index].rating == +value) {
                star.innerHTML = '☆';
                star.classList.remove("orange");
                compare_list[index].rating = +value - 1;
            }

            localStorage.setItem('compareCourses', JSON.stringify(compare_list));
        }

        var temp_value = 0

        function hoverStars(id, value, index) {
            var star = document.getElementById(id);

            if (+value > temp_value) {
                for (var i = 1; i <= value; i++) {
                    var star_fill = document.getElementById("course-" + index + "-star" + i);
                    star_fill.innerHTML = "★";
                    star_fill.classList.add("orange");
                }
                temp_value = +value
            } else if (+value < temp_value) {
                for (var i = 3; i > +value; i--) {
                    var star_fill = document.getElementById("course-" + index + "-star" + i);
                    star_fill.innerHTML = "☆";
                    star_fill.classList.remove("orange");
                }
                temp_value = +value
            }
        }

        function mouseExitStars(index) {
            console.log(index)
        }

        function prefillStars(index) {
            for (i = 1; i <= compare_list[index].rating; i++) {
                var star = document.getElementById("course-" + index + "-star" + i);
                star.innerHTML = "★";
                star.classList.add("orange");
            }
        }


    </script>

    <style>
        .orange {
            color: orange !important;
        }
    </style>

{% endblock %}

{% block content %}

<div class="d-block d-sm-none comparison__xs-rotate mb-sm-4 course-comparison-body">
    <div class="mx-auto p-4">
        <div class="row my-3">
            <div class="mx-auto">
                <i class="fas fa-mobile-alt fa-5x align-text-bottom mx-3"></i>
                <i class="fas fa-sync-alt fa-5x align-text-bottom mx-3"></i>
                <i class="fas fa-mobile-alt fa-rotate-90 fa-5x align-text-bottom mx-4"></i>
            </div>

        </div>
        <h3 class="text-center">Please rotate your device to landscape to view this page</h3>
    </div>
</div>
<div class="comparison d-none d-sm-block mb-5">
    <div class="comparison__body pt-1">

        <h2 class="comparison__heading">
            {{ page.compare_heading }}
        </h2>

        <div class="comparison__top-container">
            <div class="comparison__top-container-need-help-box">
                <h4>Need help choosing?</h4>
                <p>Search our guidelines for help making the best decision for you.</p>
                <p style="margin-bottom: 0px;">Go to Information and advice</p>
            </div>
            <div class="comparison__top-container-add-btn" style="">
                <a id="addCoursesLink"
                   href="/{% get_translation key='bookmarks-manage' language=page.get_language %}/">
                    <button id="addCourses" class="comparison__top-container-add-btn-add-courses-button">
                        <span style="font-size:20px;">+</span> <span
                            style="padding-left: 10px;">Add saved course</span>
                    </button>
                </a>
                <p class="comparison__top-container-add-btn-compare-text" style="display: inline-block;">Compare up
                    to 7 courses</p>
            </div>

        </div>
        <div class="course-detail__course-container">
            {% if courses %}
                <div class="course-detail__course-selected">
                    {{ courses|length }} courses selected
                </div>
                <form id="compareForm" method="GET"
                      action="/{% get_translation key='course_comparison_link' language=page.get_language %}">
                    <div id="hiddenCourseCompare"></div>
                </form>
                {% for course in courses %}
                    {% include 'courses/partials/course_comparison_overview.html' %}
                {% endfor %}
            {% endif %}
        </div>

        {% with dataset=courses_data.0.course_details %}
            <div class="course_comparison-table__row-header">
                {{ dataset.title }}
            </div>
            {% for item, value in dataset.dataset.items %}
                {% if forloop.counter == 3 %}
                    <!-- Hidden content start -->
                    <div class="accordion">
                        <div class="accordion-body">

                    {% endif %}
                    {% include 'courses/partials/comparison_courses_row.html' with title=value.title values=value.values %}
                    {% if forloop.last %}
                        </div>
                    <!-- Hidden content end -->
                    <!-- Show more start-->
                    {% with action=dataset.call_to_action.0.show_more %}
                        <div tabindex="0" role="button" aria-label="{{ action.affirmative }}"
                             class="accordion-header">
                            <div class="accordion-title">
                                <div class="accordion-header course_comparison-table__row-header"
                                     style="font-size: 16px; font-weight: normal;">
                                <i class="fas fa-chevron-down expand" alt="expand"
                                   style="font-size: 20px; margin-right: 4px;"
                                   aria-label="{{ action.affirmative }}"></i>
                                <i class="fas fa-chevron-up collapse" alt="collapse"
                                   style=" font-size: 20px;margin-right: 4px;"
                                   aria-label="{{ action.negative }}"></i>
                                <span class="expand">{{ action.affirmative }}</span>
                                <span class="collapse">{{ action.negative }}</span>
                            {% endwith %}
                                </div>
                            </div>
                         </div>
                     </div>
                <!-- show more end -->
            {% endif %}
            {% endfor %}
        {% endwith %}

        <div class="course-detail__body">
            <div class="course-detail__accordion-block">
                {% for accordion in page.accordions %}
                    {% create_list course1 course2 as courses %}
                    {% should_show_accordion courses accordion.value.data_set as show_accordion %}
                    {% if show_accordion %}
                    
                    <div id="{{ accordion.value.data_set }}" class="my-3 course-detail__accordion sticky-top" >
                         <button class="course-detail__accordion-heading" onclick="toggle_icon('accordion_icon_{{ forloop.counter }}')">
                                <span class="float-left">
                                    <h2 id="course-detail__accordion-heading-{{ forloop.counter }}"
                                        aria-controls="course-detail__accordion-body-{{ forloop.counter }}"
                                        aria-label="Show {{ accordion.value.heading }} content"
                                        aria-expanded="false">
                                    {{ accordion.value.heading }}

                                </h2>
                                </span>
                                <span class="float-right pr-3">
                                    <i id="accordion_icon_{{ forloop.counter }}" class="fas fa-plus text-right text-white"></i>
                                 </span>

                            </button>

                        <div id="course-detail__accordion-body-{{ forloop.counter }}"
                            class="course-detail__accordion-body "
                            aria-labelledby="course-detail__accordion-heading-{{ forloop.counter }}">
                            <div class="bg-light text-dark">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vel hendrerit purus. Aenean vestibulum leo eu risus luctus, ut luctus eros elementum. Nam ut ipsum mauris. Suspendisse lobortis id mi sit amet fermentum. Vestibulum egestas ut orci dapibus gravida. Interdum et malesuada fames ac ante ipsum primis in faucibus. Suspendisse maximus orci et libero gravida, in mattis felis efficitur. Duis vehicula lectus et faucibus tincidunt. Mauris luctus odio neque, nec porta lacus pretium vitae. Suspendisse euismod scelerisque diam vitae vehicula. Aliquam sagittis gravida est, id vulputate massa aliquet vel. Nunc venenatis sagittis lorem, a dignissim ligula porta et. Integer sed tellus ac leo sodales volutpat sit amet sit amet purus. Praesent imperdiet, arcu id tincidunt fringilla, nisl lorem sollicitudin odio, euismod viverra velit nisi sit amet libero. In magna purus, faucibus vitae rutrum nec, tincidunt at dui.

                                Duis in dolor iaculis quam congue porta. Proin ex odio, imperdiet a consectetur eget, mattis eget diam. Morbi ultrices arcu vel mi porta, eu tincidunt augue congue. Aliquam in vehicula quam. Praesent a sem scelerisque, dignissim nibh vel, interdum nunc. Quisque ullamcorper tincidunt turpis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae;
                                
                                Nulla volutpat finibus tellus a malesuada. Mauris dapibus quam id sem aliquam accumsan. Suspendisse et turpis nec erat varius tristique eget non enim. Vivamus sed eleifend lorem. Vivamus et arcu metus. Sed odio nibh, volutpat ac gravida quis, porta eget turpis. Vivamus at rutrum ipsum. Praesent dictum sem quis egestas mollis. Nullam fringilla tincidunt tortor at vehicula. Ut erat enim, ultrices et placerat sed, luctus ac purus. Nulla quis ornare elit, eget molestie ex. Ut sem tortor, imperdiet vitae auctor vitae, pretium in nulla. Fusce et accumsan justo, eget eleifend diam. Aenean eu lorem ligula. Vivamus lobortis augue est, quis convallis enim scelerisque nec. Suspendisse posuere suscipit ipsum, ut mollis odio pretium et.
                                
                                Vestibulum mi augue, dapibus non dignissim et, porttitor sit amet dolor. Integer ligula diam, fringilla in feugiat et, placerat eget elit. Phasellus porta molestie ligula. Donec quis congue odio. Suspendisse id nunc a sem tristique placerat. Nullam porta tristique lacus non rhoncus. Curabitur a ipsum vel metus mollis tempus sit amet ac purus.
                                
                                Nulla facilisi. Cras tellus neque, mollis sed sodales pellentesque, tristique at nunc. Fusce elementum porttitor ex. Sed purus quam, faucibus id feugiat a, tempus a nisl. Etiam et ex malesuada, elementum nibh quis, euismod orci. In dignissim varius metus et elementum. Pellentesque eu fringilla felis, a maximus tellus. Vestibulum ut nisl scelerisque, sollicitudin mauris et, maximus sapien. Integer molestie laoreet elementum. Quisque id ipsum id magna dignissim semper. Cras vestibulum diam porttitor urna fermentum interdum. Pellentesque lacinia, elit tincidunt auctor faucibus, lacus elit sagittis mi, at iaculis justo lorem eget arcu. Sed vel posuere ligula, vulputate ullamcorper dolor. Suspendisse vitae bibendum dolor, id tincidunt justo. Nam eu egestas tellus.</div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- {% include 'courses/partials/compare-popup-bar.html' %} -->
        </div>
    </div>
    {% endblock %}
