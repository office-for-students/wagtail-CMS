{% extends "base.html" %}
{% include 'courses/partials/sticky_header.html' %}
{% load staticfiles sass_tags wagtailcore_tags discover_uni_tags %}


{% block extra_css %}
    <link href="{% sass_src 'scss/course_comparison.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/home.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/course_detail.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
    <link href="{% sass_src 'scss/accordions.scss' %}?{% code_version %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block extra_js %}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script type="text/javascript" src="{% static 'js/label_explanation_popups.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/overview_blocks.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/sub_accordion.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/accordion.js' %}"></script>

{% endblock %}

{% block content %}

    <div class="comparison d-sm-block mb-5" id="comparison-body"></div>

    <script>

        const event = new Event('build-accordions');
        let local_storage = localStorage.getItem("CoursesForComparison");
        let array = [];
        if (local_storage) {
            array = JSON.parse(local_storage);
        }
        list = []
        array.forEach(function (value, index) {
            list.push(value.id);
        })
        urls_params = list.join('&courses=');

        function showComparison(array) {
            var xmlhttp;
            if (!array) {
                document.getElementById("comparison-body").innerHTML = "";
                return;
            }
            xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    document.getElementById("comparison-body").innerHTML = this.responseText;
                    moveIndexToDisplayBy(0);
                    document.dispatchEvent(event);
                }
            };

            let saved = [];
            if (localStorage.getItem("bookmarkedCourses"))
                saved = JSON.parse(localStorage.getItem("bookmarkedCourses"));
            if (document.documentElement.lang === "cy") {
                console.log("should be welsh");
                xmlhttp.open("GET", "/cy/ajax/course-comparison/?courses=" + urls_params + '&hasStorage=' + saved.length, true);
            } else {
                xmlhttp.open("GET", "/ajax/course-comparison/?courses=" + urls_params + '&hasStorage=' + saved.length, true);
            }
            xmlhttp.send();
        }

        showComparison(array);
    </script>

    <script type="text/javascript" src="{% static 'js/ratings.js' %}?{% code_version %}"></script>
    <script type="text/javascript" src="{% static 'js/responsive_comparison.js' %}?{% code_version %}"></script>
{% endblock %}
